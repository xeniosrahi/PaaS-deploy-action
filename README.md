# PaaS-deploy-action
A Github action for deploying PaaS on Edge / Home PCs

# CapRover + Cloudflared + IPv6 + GPU/TPU + Tailscale (Tunneled by Default)

This repository provides a full bundle of GitHub Actions and a minimal app for deploying and managing a distributed CapRover cluster with advanced networking and GPU/TPU support.

## Key Features

- **CapRover Manager Bootstrap** (`caprover-bootstrap.yml`)
  - Bootstraps a CapRover manager on Ubuntu 24.04.
  - All apps tunneled by default through **Cloudflare Tunnel** (`*.apps.<root>`, `captain.<root>`).
  - Optional toggle for **public IPv6 exposure + Let’s Encrypt** (direct AAAA records supported).
  - Enables Docker IPv6 with autogenerated **ULA ranges**.

- **Node Join Workflow** (`caprover-node-join.yml`)
  - Adds workers or managers to the swarm.
  - Enables Docker IPv6 (ULA).
  - Supports **GPU/TPU preparation** (NVIDIA, AMD, Coral TPU).
  - Auto-labels nodes with `gpu=<type>`.
  - Optional **Tailscale join** and **Exit Node** setup.

- **Immich Deployment** (`immich-deploy.yml`)
  - Deploys [Immich](https://immich.app/) on CapRover.
  - Quota-backed loopback volume for primary storage.
  - Supports extra mounts for media folders.
  - Placement rules so ML service lands only on GPU nodes.

- **App Placement Patch** (`caprover-app-placement-patch.yml`)
  - Injects placement constraints into any CapRover app by label.
  - Optionally attaches an `ipv6-public` network with fixed IPv6s.

- **IPv6 Pool Setup** (`ipv6-pool-setup.yml`)
  - Creates a Docker `ipv6-public` network using a routed `/64`.
  - Optionally installs `ndppd` for neighbor discovery proxying.

- **Cloudflared Tunnel Toggle** (`cloudflared-tunnel-toggle.yml`)
  - Per-FQDN deny/allow for Cloudflare Tunnel.
  - Default is **tunneled**, but apps can be opted out and exposed only via direct IPv6.

- **Apex Welcome App** (`apps/apex-welcome`)
  - A simple NGINX app that serves the apex/root domain.
  - Landing page confirms IPv6 + tunnel readiness.

## System Behavior Summary

- All CapRover apps are tunneled by default through Cloudflare.
- Public IPv6 + Let’s Encrypt can be enabled for direct AAAA access.
- Users can bring their own DNS by pointing AAAA to the node’s IPv6.
- Workers can be GPU/TPU-enabled and labeled automatically.
- Placement constraints ensure workloads land on the right nodes.
- Immich is preconfigured with quota volumes and GPU ML node placement.
- You can selectively deny tunnel access for certain apps.

## For AI/LLM Usage

If you want to provide this description to an AI model for context:

- It describes a CapRover cluster managed with GitHub Actions on Ubuntu 24.04.
- All apps are tunneled by default via Cloudflare.
- IPv6 direct access and BYO DNS are supported.
- GPU/TPU support and node labeling are built in.
- Immich is set up with proper storage and GPU placement.
- Workflows exist for patching, IPv6 networking, and tunnel control.
- A simple apex landing app is included.

## Repository Layout

```text
.
├─ .github/workflows/
│  ├─ caprover-bootstrap.yml
│  ├─ caprover-node-join.yml
│  ├─ caprover-node-labels.yml
│  ├─ immich-deploy.yml
│  ├─ caprover-app-placement-patch.yml
│  ├─ cloudflared-tunnel-toggle.yml
│  └─ ipv6-pool-setup.yml
├─ apps/apex-welcome/
│  ├─ Dockerfile
│  ├─ index.html
│  └─ captain-definition
└─ README.md
```

